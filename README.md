# 금융 이상거래 탐지 시스템 (FDS) PoC for NH

**규칙 기반과 통계적 분석을 결합한 실시간 금융 이상거래 탐지(FDS) 시스템의 개념 증명(Proof of Concept) 프로젝트입니다.**

이 시스템은 사용자의 과거 거래 데이터를 기반으로 개인화된 프로필을 생성하고, 새로운 거래가 발생했을 때 평소 패턴에서 얼마나 벗어나는지를 측정하여 위험도를 산출합니다. 머신러닝 모델을 통합할 수 있도록 확장성을 고려하여 설계되었습니다.

-----

## 주요 특징

  * **하이브리드 접근 방식**: 명시적인 \*\*규칙(Rule-based)\*\*과 사용자의 과거 행동 \*\*통계(Statistics-based)\*\*를 결합하여 탐지 정확도를 높입니다.
  * **설명 가능한 결과 (XAI)**: 각 거래가 왜 위험한지 "평소와 다른 IP 사용", "금액 이상치" 등 사람이 이해할 수 있는 명확한 근거를 함께 제공합니다.
  * **실시간 처리**: 새로운 거래 1건이 발생했을 때, 사전에 생성된 프로필을 기반으로 즉시 위험도를 계산합니다.
  * **확장성**: `scikit-learn`을 활용한 머신러닝 모델(지도/비지도)을 손쉽게 통합하여 시스템을 고도화할 수 있는 구조를 갖추고 있습니다.

-----

## 프로젝트 구조

```
/
├── risk_engine.py          # 핵심 위험도 평가 로직이 담긴 모듈
├── main.py                 # 데이터 로드, 프로필 생성, 분석 실행을 위한 메인 스크립트
├── transaction_data.csv    # 분석에 사용되는 샘플 거래 데이터셋
└── README.md               # 프로젝트 설명서
```

-----

## 설치 및 환경 설정

이 프로젝트를 실행하기 위해서는 **Python 3.8 이상**과 아래의 라이브러리가 필요합니다.

1.  **프로젝트 클론**

    ```bash
    git clone https://github.com/seoyoungleeme/NH_FSD
    cd /NH_FSD
    ```

2.  **라이브러리 설치**

    ```bash
    pip install pandas scikit-learn
    ```

-----

## 실행 방법

1.  **데이터 준비**: 프로젝트 루트 디렉토리에 `transaction_data.csv` 파일을 위치시킵니다.

2.  **분석 대상 지정**: `main.py` 파일을 열어 분석하고 싶은 거래의 인덱스를 수정합니다.

    ```python
    # main.py
    # ...
    # 분석할 거래의 인덱스를 지정합니다.
    sample_index = 150 # ◀ 이 숫자를 원하는 값으로 변경 (예: 200)
    # ...
    ```

3.  **스크립트 실행**: 터미널에서 다음 명령어를 입력하여 위험도 분석을 실행합니다.

    ```bash
    python main.py
    ```

4.  **결과 확인**: 터미널에 해당 거래의 위험도 점수와 주요 탐지 사유가 출력됩니다.

    ```
    분석 완료! 최종 결과:
    ==============================
    [위험도 2.57/100]
    거래 금액: 69, 시간: 2023-07-24T18:08:43, 상대: M073
    주요 사유:
    - 금액 이상치(z=0.86, mean=322, std=296)
    ==============================
    ```

-----

## 시스템 동작 원리

이 시스템은 두 가지 주요 단계로 동작합니다.

1.  **1단계: 사용자 프로필 생성**
    `main.py`가 전체 `transaction_data.csv`를 읽어 각 사용자별로 과거 행동 패턴(평균 거래액, 주 사용 시간대/IP/기기 등)을 요약한 통계 프로필을 생성하여 메모리에 저장합니다.

2.  **2단계: 실시간 위험도 평가**
    분석 대상으로 지정된 거래가 발생하면, `RiskEngine`은 해당 사용자의 프로필과 거래 정보를 비교하여 미리 정의된 여러 규칙(예: `rule_ip_device`, `rule_time`) 및 통계 모델(`anomaly_amount`)에 따라 위험 요소를 평가하고, 최종 위험도 점수를 계산합니다.

-----

## 향후 개선 방향

  * **가중치 최적화**: `RiskWeights` 클래스의 각 위험 요소별 가중치를 실제 사기 데이터를 기반으로 튜닝하여 탐지 성능을 최적화할 수 있습니다.
  * **규칙 추가**: `LoginAttempts`, `TransactionDuration` 등 데이터셋의 다른 변수를 활용하여 새로운 탐지 규칙을 추가할 수 있습니다.
  * **머신러닝 모델 통합**: `IsolationForest` (비지도)나 `RandomForest` (지도) 같은 머신러닝 모델을 학습시켜, 규칙 기반 시스템이 탐지하지 못하는 복합적인 이상 패턴을 추가적인 위험 요소로 활용할 수 있습니다.